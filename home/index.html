<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">éŠæˆ² - ä¸»é </title>
    <link rel="stylesheet" href="/public/css/style.css">
</head>
<body>
    <div class="container">
        <h1 id="gameTitle">ğŸ¯ å•ç­”éŠæˆ²</h1>
        <p style="margin-bottom: 30px; color: #666; font-size: 1.2em;">
            æ­¡è¿ä¾†åˆ°å¤šäººå³æ™‚å•ç­”éŠæˆ²ï¼<br>
            è¼¸å…¥æ‚¨çš„åå­—é–‹å§‹éŠæˆ²
        </p>

        <form id="joinForm">
            <input
                type="text"
                id="playerName"
                placeholder="è«‹è¼¸å…¥æ‚¨çš„åå­—"
                required
                maxlength="20"
                autocomplete="off"
            >
            <button type="submit" id="joinButton">
                ğŸš€ é–‹å§‹éŠæˆ²
            </button>
        </form>

        <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 15px;">
            <h3 style="color: #333; margin-bottom: 15px;">éŠæˆ²è¦å‰‡</h3>
            <ul style="text-align: left; color: #666; line-height: 1.6;">
                <li>æ¯é¡Œæœ‰4å€‹é¸é …ï¼Œé¸æ“‡æ­£ç¢ºç­”æ¡ˆç²å¾—åˆ†æ•¸</li>
                <li>ç­”é¡Œé€Ÿåº¦è¶Šå¿«ï¼Œç²å¾—åˆ†æ•¸è¶Šé«˜</li>
                <li>æ¯é¡Œé™æ™‚10ç§’ä½œç­”</li>
                <li>æ”¯æŒæ–·ç·šé‡é€£ï¼Œä¸æœƒä¸Ÿå¤±é€²åº¦</li>
                <li>æœ€çµ‚æœƒé¡¯ç¤ºæ’è¡Œæ¦œå’Œå‰ä¸‰å</li>
            </ul>
        </div>

        <div style="margin-top: 20px;">
            <a href="/admin" style="color: #667eea; text-decoration: none; font-size: 14px;">
                ğŸ“Š å¾Œå°ç®¡ç†
            </a>
        </div>
    </div>

    <script>
        // è¼‰å…¥éŠæˆ²é…ç½®
        async function loadGameConfig() {
            try {
                const response = await fetch('/api/config');
                const config = await response.json();

                // æ›´æ–°é é¢æ¨™é¡Œå’ŒéŠæˆ²åç¨±
                document.getElementById('pageTitle').textContent = `${config.gameName} - ä¸»é `;
                document.getElementById('gameTitle').textContent = `ğŸ¯ ${config.gameName}`;
                document.title = `${config.gameName} - ä¸»é `;
            } catch (error) {
                console.log('ç„¡æ³•è¼‰å…¥éŠæˆ²é…ç½®ï¼Œä½¿ç”¨é è¨­å€¼');
            }
        }

        // è¼‰å…¥é…ç½®
        loadGameConfig();

        // æª¢æŸ¥é‡é€£
        checkForReconnection();

        const form = document.getElementById('joinForm');
        const nameInput = document.getElementById('playerName');
        const joinButton = document.getElementById('joinButton');

        // æª¢æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„åå­—ï¼ˆåƒ…ç•¶å‰åˆ†é ï¼‰
        const savedName = sessionStorage.getItem('playerName');
        if (savedName) {
            nameInput.value = savedName;
        }

        // æª¢æŸ¥æ˜¯å¦æœ‰æ­£åœ¨é€²è¡Œçš„éŠæˆ²ï¼ˆæ–·ç·šé‡é€£ï¼‰
        function checkForReconnection() {
            const savedUserId = localStorage.getItem('gameUserId');
            const savedUserName = localStorage.getItem('gameUserName');

            if (savedUserId && savedUserName) {
                // é¡¯ç¤ºé‡é€£é¸é …
                showReconnectionOption(savedUserName);
            }
        }

        // é¡¯ç¤ºé‡é€£é¸é …
        function showReconnectionOption(userName) {
            const form = document.getElementById('joinForm');

            // å‰µå»ºé‡é€£å€åŸŸ
            const reconnectDiv = document.createElement('div');
            reconnectDiv.id = 'reconnectSection';
            reconnectDiv.style.cssText = `
                margin-bottom: 30px;
                padding: 20px;
                background: #e8f5e8;
                border-radius: 15px;
                border-left: 4px solid #28a745;
            `;

            reconnectDiv.innerHTML = `
                <h3 style="color: #155724; margin-top: 0;">ğŸ”„ ç™¼ç¾æœªå®Œæˆçš„éŠæˆ²</h3>
                <p style="color: #155724; margin-bottom: 15px;">
                    ç©å®¶: <strong>${userName}</strong><br>
                    æ‚¨å¯ä»¥é‡æ–°é€£æ¥åˆ°æ­£åœ¨é€²è¡Œçš„éŠæˆ²
                </p>
                <button type="button" id="reconnectBtn" style="
                    background: #28a745;
                    color: white;
                    border: none;
                    padding: 12px 20px;
                    border-radius: 8px;
                    cursor: pointer;
                    margin-right: 10px;
                ">ğŸš€ é‡æ–°é€£æ¥</button>
                <button type="button" id="newGameBtn" style="
                    background: #6c757d;
                    color: white;
                    border: none;
                    padding: 12px 20px;
                    border-radius: 8px;
                    cursor: pointer;
                ">ğŸ†• é–‹å§‹æ–°éŠæˆ²</button>
            `;

            form.parentNode.insertBefore(reconnectDiv, form);

            // è¨­ç½®äº‹ä»¶ç›£è½å™¨
            document.getElementById('reconnectBtn').addEventListener('click', () => {
                window.location.href = `/game?reconnect=true`;
            });

            document.getElementById('newGameBtn').addEventListener('click', () => {
                // æ¸…é™¤ä¿å­˜çš„éŠæˆ²è³‡æ–™
                localStorage.removeItem('gameUserId');
                localStorage.removeItem('gameUserName');
                reconnectDiv.remove();
            });
        }

        form.addEventListener('submit', (e) => {
            e.preventDefault();

            const name = nameInput.value.trim();
            if (!name) {
                alert('è«‹è¼¸å…¥æ‚¨çš„åå­—ï¼');
                return;
            }

            if (name.length > 20) {
                alert('åå­—é•·åº¦ä¸èƒ½è¶…é20å€‹å­—ç¬¦ï¼');
                return;
            }

            // ä¿å­˜åå­—ï¼ˆåƒ…ç•¶å‰åˆ†é ï¼‰
            sessionStorage.setItem('playerName', name);

            // è·³è½‰åˆ°éŠæˆ²é é¢
            window.location.href = `/game?name=${encodeURIComponent(name)}`;
        });

        // è¼¸å…¥æ¡†ç„¦é»
        nameInput.focus();

        // æŒ‰Enteréµæäº¤
        nameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                form.requestSubmit();
            }
        });

        // æª¢æŸ¥ä¼ºæœå™¨é€£æ¥ç‹€æ…‹
        fetch('/')
            .then(() => {
                console.log('ä¼ºæœå™¨é€£æ¥æ­£å¸¸');
            })
            .catch(() => {
                const warning = document.createElement('div');
                warning.innerHTML = `
                    <div style="background: #fff3cd; border: 1px solid #ffeaa7; color: #856404;
                                padding: 15px; border-radius: 10px; margin-top: 20px;">
                        âš ï¸ ç„¡æ³•é€£æ¥åˆ°éŠæˆ²ä¼ºæœå™¨ï¼Œè«‹ç¢ºèªä¼ºæœå™¨æ˜¯å¦é‹è¡Œä¸­
                    </div>
                `;
                document.querySelector('.container').appendChild(warning);
            });
    </script>
</body>
</html>