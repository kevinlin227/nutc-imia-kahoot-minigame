<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kahoot éŠæˆ² - å¾Œå°ç®¡ç†</title>
    <link rel="stylesheet" href="/public/css/style.css">
    <style>
        .admin-container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
        }

        .admin-panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .status-panel {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .status-card h3 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .status-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .control-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }

        .control-buttons button {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            font-size: 16px;
        }

        .admin-users-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
        }

        .admin-user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .admin-user-item.offline {
            opacity: 0.5;
            border-left-color: #dc3545;
        }

        .questions-preview {
            margin-top: 30px;
        }

        .question-item {
            background: #f8f9fa;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 4px solid #28a745;
        }

        .question-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .question-option {
            padding: 10px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .question-option.correct {
            background: #d4edda;
            border-color: #28a745;
            font-weight: bold;
        }

        .game-log {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
            color: #333;
        }

        .monitoring-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .countdown-display {
            background: #667eea;
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            font-size: 2em;
            font-weight: bold;
            display: none;
        }

        .countdown-display.active {
            display: block;
        }

        .answer-stats {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .answer-option {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .option-label {
            width: 60px;
            font-weight: bold;
        }

        .option-bar {
            flex: 1;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            margin: 0 10px;
            position: relative;
            overflow: hidden;
        }

        .option-fill {
            height: 100%;
            border-radius: 15px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .option-fill.option-a { background: #e74c3c; }
        .option-fill.option-b { background: #3498db; }
        .option-fill.option-c { background: #f39c12; }
        .option-fill.option-d { background: #27ae60; }

        .response-summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }

        .response-count {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }

        .log-entry.info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .log-entry.warning {
            background: #fff3cd;
            color: #856404;
        }

        .log-entry.error {
            background: #f8d7da;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .admin-container {
                margin: 10px;
                padding: 10px;
            }

            .status-panel {
                grid-template-columns: 1fr;
            }

            .monitoring-panel {
                grid-template-columns: 1fr;
            }

            .control-buttons {
                flex-direction: column;
            }

            .control-buttons button {
                min-width: auto;
            }

            .countdown-display {
                font-size: 1.5em;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-panel">
            <h1>ğŸ® Kahoot éŠæˆ²å¾Œå°ç®¡ç†</h1>

            <!-- éŠæˆ²ç‹€æ…‹ç¸½è¦½ -->
            <div class="status-panel">
                <div class="status-card">
                    <h3>éŠæˆ²ç‹€æ…‹</h3>
                    <div id="gameStatus" class="value">ç­‰å¾…ä¸­</div>
                </div>
                <div class="status-card">
                    <h3>åƒèˆ‡äººæ•¸</h3>
                    <div id="playerCount" class="value">0</div>
                </div>
                <div class="status-card">
                    <h3>ç•¶å‰é¡Œç›®</h3>
                    <div id="currentQuestion" class="value">-</div>
                </div>
            </div>

            <!-- å³æ™‚ç›£æ§é¢æ¿ -->
            <div class="monitoring-panel">
                <!-- å€’è¨ˆæ™‚é¡¯ç¤º -->
                <div>
                    <div id="gameCountdown" class="countdown-display">
                        éŠæˆ²é–‹å§‹å€’è¨ˆæ™‚: <span id="gameCountdownValue">3</span>
                    </div>
                    <div id="questionCountdown" class="countdown-display">
                        é¡Œç›®å€’è¨ˆæ™‚: <span id="questionCountdownValue">10</span>
                    </div>
                    <div id="nextQuestionCountdown" class="countdown-display">
                        ä¸‹ä¸€é¡Œå€’è¨ˆæ™‚: <span id="nextQuestionCountdownValue">3</span>
                    </div>
                </div>

                <!-- ä½œç­”çµ±è¨ˆ -->
                <div class="answer-stats">
                    <h3>å³æ™‚ä½œç­”çµ±è¨ˆ</h3>
                    <div id="answerStatsContent">
                        <p style="text-align: center; color: #666;">ç­‰å¾…é¡Œç›®é–‹å§‹...</p>
                    </div>
                </div>
            </div>

            <!-- æ§åˆ¶æŒ‰éˆ• -->
            <div class="admin-controls">
                <h3>éŠæˆ²æ§åˆ¶</h3>
                <div class="control-buttons">
                    <button id="startGameBtn" onclick="startGame()">
                        ğŸš€ é–‹å§‹éŠæˆ²
                    </button>
                    <button id="showResultsBtn" onclick="showResults()" disabled>
                        ğŸ“Š é¡¯ç¤ºçµæœ
                    </button>
                    <button id="nextQuestionBtn" onclick="nextQuestion()" disabled>
                        â¡ï¸ ä¸‹ä¸€é¡Œ
                    </button>
                    <button id="endGameBtn" onclick="endGame()" disabled>
                        ğŸ çµæŸéŠæˆ²
                    </button>
                </div>
                <div style="margin-top: 15px;">
                    <button onclick="resetGame()" style="background: #dc3545;">
                        ğŸ”„ é‡ç½®éŠæˆ²
                    </button>
                    <button onclick="refreshData()">
                        ğŸ”„ åˆ·æ–°æ•¸æ“š
                    </button>
                </div>
            </div>

            <!-- åƒèˆ‡è€…åˆ—è¡¨ -->
            <div>
                <h3>åƒèˆ‡è€…åˆ—è¡¨</h3>
                <div id="adminUsersList" class="admin-users-list">
                    <p style="text-align: center; color: #666;">æš«ç„¡åƒèˆ‡è€…</p>
                </div>
            </div>
        </div>

        <!-- é¡Œç›®é è¦½ -->
        <div class="admin-panel">
            <h3>é¡Œç›®é è¦½</h3>
            <div id="questionsPreview" class="questions-preview"></div>
        </div>

        <!-- éŠæˆ²æ—¥èªŒ -->
        <div class="admin-panel">
            <h3>éŠæˆ²æ—¥èªŒ</h3>
            <div id="gameLog" class="game-log">
                <div class="log-entry info">ç³»çµ±å•Ÿå‹•ï¼Œç­‰å¾…é€£æ¥...</div>
            </div>
        </div>

        <!-- è¿”å›ä¸»é  -->
        <div style="text-align: center; margin-top: 20px;">
            <a href="/home" style="color: #667eea; text-decoration: none;">
                ğŸ  è¿”å›ä¸»é 
            </a>
        </div>
    </div>

    <script src="/public/js/common.js"></script>
    <script>
        // ç®¡ç†å¾Œå°ç‹€æ…‹
        const adminState = {
            gameStatus: 'waiting',
            users: [],
            currentQuestion: -1,
            questions: []
        };

        // WebSocketé€£æ¥
        const ws = new GameWebSocket();

        // åˆå§‹åŒ–
        function init() {
            // è¨­ç½®WebSocketäº‹ä»¶è™•ç†
            ws.onopen = () => {
                addLog('å·²é€£æ¥åˆ°éŠæˆ²ä¼ºæœå™¨', 'info');
                // ç™¼é€ç®¡ç†å“¡é€£æ¥è«‹æ±‚
                ws.send({ type: 'admin_connect' });
            };

            ws.onclose = () => {
                addLog('èˆ‡ä¼ºæœå™¨çš„é€£æ¥å·²æ–·é–‹', 'error');
            };

            ws.onerror = (error) => {
                addLog('é€£æ¥éŒ¯èª¤: ' + error, 'error');
            };

            // è¨»å†Šè¨Šæ¯è™•ç†å™¨
            ws.on('admin_connected', handleAdminConnected);
            ws.on('users_update', handleUsersUpdate);
            ws.on('game_starting', handleGameStarting);
            ws.on('question_start', handleQuestionStart);
            ws.on('show_results', handleShowResults);
            ws.on('next_question_countdown', handleNextQuestionCountdown);
            ws.on('game_end', handleGameEnd);
            ws.on('admin_game_starting', handleAdminGameStarting);
            ws.on('admin_question_start', handleAdminQuestionStart);
            ws.on('admin_next_question_countdown', handleAdminNextQuestionCountdown);
            ws.on('answer_stats', handleAnswerStats);
            ws.on('admin_countdown_update', handleAdminCountdownUpdate);
            ws.on('admin_time_up', handleAdminTimeUp);

            // é€£æ¥WebSocket
            ws.connect();

            // è¼‰å…¥é¡Œç›®é è¦½
            loadQuestionsPreview();

            // å®šæœŸåˆ·æ–°æ•¸æ“š
            setInterval(refreshData, 5000);
        }


        // è¼‰å…¥é¡Œç›®é è¦½
        function loadQuestionsPreview() {
            // ç”±æ–¼æˆ‘å€‘åœ¨ä¼ºæœå™¨ç«¯å®šç¾©äº†é¡Œç›®ï¼Œé€™è£¡ç›´æ¥å±•ç¤º
            const questions = [
                {
                    question: "JavaScriptä¸­å“ªå€‹æ–¹æ³•ç”¨æ–¼æ·»åŠ æ•¸çµ„å…ƒç´ ï¼Ÿ",
                    options: ["push()", "add()", "insert()", "append()"],
                    correctAnswer: 0
                },
                {
                    question: "HTMLä¸­å“ªå€‹æ¨™ç±¤ç”¨æ–¼å‰µå»ºè¶…é€£çµï¼Ÿ",
                    options: ["<link>", "<href>", "<a>", "<url>"],
                    correctAnswer: 2
                },
                {
                    question: "CSSä¸­å“ªå€‹å±¬æ€§ç”¨æ–¼è¨­ç½®æ–‡å­—é¡è‰²ï¼Ÿ",
                    options: ["text-color", "font-color", "color", "background-color"],
                    correctAnswer: 2
                }
            ];

            const container = document.getElementById('questionsPreview');
            container.innerHTML = '';

            questions.forEach((q, index) => {
                const questionElement = document.createElement('div');
                questionElement.className = 'question-item';

                questionElement.innerHTML = `
                    <h4>ç¬¬ ${index + 1} é¡Œ</h4>
                    <p style="font-size: 1.1em; margin: 10px 0; font-weight: bold;">
                        ${q.question}
                    </p>
                    <div class="question-options">
                        ${q.options.map((option, optIndex) => `
                            <div class="question-option ${optIndex === q.correctAnswer ? 'correct' : ''}">
                                ${String.fromCharCode(65 + optIndex)}. ${option}
                                ${optIndex === q.correctAnswer ? ' âœ“' : ''}
                            </div>
                        `).join('')}
                    </div>
                `;

                container.appendChild(questionElement);
            });
        }

        // è™•ç†ç®¡ç†å“¡é€£æ¥æˆåŠŸ
        function handleAdminConnected(message) {
            adminState.gameStatus = message.gameStatus;
            adminState.currentQuestion = message.currentQuestion;
            adminState.users = message.users;

            // æ›´æ–°æ‰€æœ‰é¡¯ç¤º
            updateGameStatus();
            updateCurrentQuestion();
            updatePlayerCount();
            updateUsersDisplay();
            updateControlButtons();

            addLog('ç®¡ç†å“¡é€£æ¥æˆåŠŸï¼Œå·²åŒæ­¥éŠæˆ²ç‹€æ…‹', 'info');
        }

        // è™•ç†ç”¨æˆ¶åˆ—è¡¨æ›´æ–°
        function handleUsersUpdate(message) {
            adminState.users = message.users;
            updateUsersDisplay();
            updatePlayerCount();
            addLog(`ç”¨æˆ¶åˆ—è¡¨æ›´æ–°: ${message.users.length} äººåœ¨ç·š`, 'info');
        }

        // è™•ç†éŠæˆ²é–‹å§‹
        function handleGameStarting(message) {
            adminState.gameStatus = 'starting';
            updateGameStatus();
            updateControlButtons();
            addLog('éŠæˆ²é–‹å§‹å€’è¨ˆæ™‚', 'info');
        }

        // è™•ç†é¡Œç›®é–‹å§‹
        function handleQuestionStart(message) {
            adminState.gameStatus = 'playing';
            adminState.currentQuestion = message.questionIndex;
            updateGameStatus();
            updateCurrentQuestion();
            updateControlButtons();
            addLog(`ç¬¬ ${message.questionIndex + 1} é¡Œé–‹å§‹`, 'info');
        }

        // è™•ç†çµæœé¡¯ç¤º
        function handleShowResults(message) {
            adminState.gameStatus = 'showing_results';
            updateGameStatus();
            updateControlButtons();
            addLog(`é¡¯ç¤ºç¬¬ ${adminState.currentQuestion + 1} é¡Œçµæœ`, 'info');
        }

        // è™•ç†ä¸‹ä¸€é¡Œå€’è¨ˆæ™‚
        function handleNextQuestionCountdown(message) {
            addLog('ä¸‹ä¸€é¡Œå€’è¨ˆæ™‚é–‹å§‹', 'info');
        }

        // è™•ç†éŠæˆ²çµæŸ
        function handleGameEnd(message) {
            adminState.gameStatus = 'finished';
            updateGameStatus();
            updateControlButtons();
            hideAllCountdowns();
            addLog('éŠæˆ²çµæŸ', 'info');
        }

        // è™•ç†ç®¡ç†å“¡éŠæˆ²é–‹å§‹å€’è¨ˆæ™‚
        function handleAdminGameStarting(message) {
            showGameCountdown(message.countdown);
        }

        // è™•ç†ç®¡ç†å“¡é¡Œç›®é–‹å§‹
        function handleAdminQuestionStart(message) {
            hideAllCountdowns();
            showQuestionCountdown(message.timeLimit / 1000, true); // ä½¿ç”¨æœå‹™å™¨æ™‚é–“
            resetAnswerStats();
            addLog(`ç¬¬ ${message.questionIndex + 1} é¡Œ: ${message.question.question}`, 'info');
        }

        // è™•ç†æœå‹™å™¨å€’è¨ˆæ™‚æ›´æ–°
        function handleAdminCountdownUpdate(message) {
            updateQuestionCountdown(message.remaining);
        }

        // è™•ç†æ™‚é–“åˆ°äº†
        function handleAdminTimeUp(message) {
            updateQuestionCountdown(0);
            updateAnswerStats(message.stats);
            addLog(`ç¬¬ ${message.questionIndex + 1} é¡Œæ™‚é–“åˆ°ï¼`, 'warning');
        }

        // è™•ç†ç®¡ç†å“¡ä¸‹ä¸€é¡Œå€’è¨ˆæ™‚
        function handleAdminNextQuestionCountdown(message) {
            hideAllCountdowns();
            showNextQuestionCountdown(message.countdown);
        }

        // è™•ç†ä½œç­”çµ±è¨ˆæ›´æ–°
        function handleAnswerStats(message) {
            updateAnswerStats(message.stats);
        }

        // é¡¯ç¤ºéŠæˆ²é–‹å§‹å€’è¨ˆæ™‚
        function showGameCountdown(seconds) {
            hideAllCountdowns();
            const countdown = document.getElementById('gameCountdown');
            const valueElement = document.getElementById('gameCountdownValue');

            countdown.classList.add('active');
            valueElement.textContent = seconds;

            const interval = setInterval(() => {
                seconds--;
                if (seconds <= 0) {
                    clearInterval(interval);
                    countdown.classList.remove('active');
                } else {
                    valueElement.textContent = seconds;
                }
            }, 1000);
        }

        // é¡¯ç¤ºé¡Œç›®å€’è¨ˆæ™‚
        function showQuestionCountdown(seconds, useServerTime = false) {
            hideAllCountdowns();
            const countdown = document.getElementById('questionCountdown');
            const valueElement = document.getElementById('questionCountdownValue');

            countdown.classList.add('active');
            valueElement.textContent = seconds;

            if (!useServerTime) {
                // åªæœ‰åœ¨ä¸ä½¿ç”¨æœå‹™å™¨æ™‚é–“æ™‚æ‰å•Ÿå‹•æœ¬åœ°å€’è¨ˆæ™‚
                const interval = setInterval(() => {
                    seconds--;
                    if (seconds <= 0) {
                        clearInterval(interval);
                        valueElement.textContent = 'æ™‚é–“åˆ°!';
                        setTimeout(() => {
                            countdown.classList.remove('active');
                        }, 2000);
                    } else {
                        valueElement.textContent = seconds;
                    }
                }, 1000);
            }
        }

        // æ›´æ–°é¡Œç›®å€’è¨ˆæ™‚ï¼ˆç”±æœå‹™å™¨æ§åˆ¶ï¼‰
        function updateQuestionCountdown(seconds) {
            const valueElement = document.getElementById('questionCountdownValue');
            if (seconds <= 0) {
                valueElement.textContent = 'æ™‚é–“åˆ°!';
                setTimeout(() => {
                    document.getElementById('questionCountdown').classList.remove('active');
                }, 2000);
            } else {
                valueElement.textContent = seconds;
            }
        }

        // é¡¯ç¤ºä¸‹ä¸€é¡Œå€’è¨ˆæ™‚
        function showNextQuestionCountdown(seconds) {
            hideAllCountdowns();
            const countdown = document.getElementById('nextQuestionCountdown');
            const valueElement = document.getElementById('nextQuestionCountdownValue');

            countdown.classList.add('active');
            valueElement.textContent = seconds;

            const interval = setInterval(() => {
                seconds--;
                if (seconds <= 0) {
                    clearInterval(interval);
                    countdown.classList.remove('active');
                } else {
                    valueElement.textContent = seconds;
                }
            }, 1000);
        }

        // éš±è—æ‰€æœ‰å€’è¨ˆæ™‚
        function hideAllCountdowns() {
            document.getElementById('gameCountdown').classList.remove('active');
            document.getElementById('questionCountdown').classList.remove('active');
            document.getElementById('nextQuestionCountdown').classList.remove('active');
        }

        // é‡ç½®ä½œç­”çµ±è¨ˆ
        function resetAnswerStats() {
            const content = document.getElementById('answerStatsContent');
            content.innerHTML = `
                <div class="answer-option">
                    <div class="option-label">A:</div>
                    <div class="option-bar">
                        <div class="option-fill option-a" style="width: 0%">0%</div>
                    </div>
                </div>
                <div class="answer-option">
                    <div class="option-label">B:</div>
                    <div class="option-bar">
                        <div class="option-fill option-b" style="width: 0%">0%</div>
                    </div>
                </div>
                <div class="answer-option">
                    <div class="option-label">C:</div>
                    <div class="option-bar">
                        <div class="option-fill option-c" style="width: 0%">0%</div>
                    </div>
                </div>
                <div class="answer-option">
                    <div class="option-label">D:</div>
                    <div class="option-bar">
                        <div class="option-fill option-d" style="width: 0%">0%</div>
                    </div>
                </div>
                <div class="answer-option">
                    <div class="option-label">æœªç­”:</div>
                    <div class="option-bar">
                        <div class="option-fill" style="width: 100%; background: #6c757d;">100% (0)</div>
                    </div>
                </div>
                <div class="response-summary">
                    <div class="response-count">0/0</div>
                    <div>å·²ä½œç­”äººæ•¸</div>
                </div>
            `;
        }

        // æ›´æ–°ä½œç­”çµ±è¨ˆ
        function updateAnswerStats(stats) {
            const content = document.getElementById('answerStatsContent');
            const options = ['A', 'B', 'C', 'D'];
            const colors = ['option-a', 'option-b', 'option-c', 'option-d'];

            let html = '';

            options.forEach((option, index) => {
                const percentage = stats.answerPercentages[index] || 0;
                const count = stats.answerCounts[index] || 0;

                html += `
                    <div class="answer-option">
                        <div class="option-label">${option}:</div>
                        <div class="option-bar">
                            <div class="option-fill ${colors[index]}" style="width: ${percentage}%">
                                ${percentage}% (${count})
                            </div>
                        </div>
                    </div>
                `;
            });

            // æ·»åŠ æœªä½œç­”çµ±è¨ˆ
            if (stats.unansweredCount > 0) {
                html += `
                    <div class="answer-option">
                        <div class="option-label">æœªç­”:</div>
                        <div class="option-bar">
                            <div class="option-fill" style="width: ${stats.unansweredPercentage}%; background: #6c757d;">
                                ${stats.unansweredPercentage}% (${stats.unansweredCount})
                            </div>
                        </div>
                    </div>
                `;
            }

            html += `
                <div class="response-summary">
                    <div class="response-count">${stats.answeredCount}/${stats.totalUsers}</div>
                    <div>å·²ä½œç­”äººæ•¸</div>
                </div>
            `;

            content.innerHTML = html;
        }

        // æ›´æ–°ç”¨æˆ¶é¡¯ç¤º
        function updateUsersDisplay() {
            const container = document.getElementById('adminUsersList');

            if (adminState.users.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">æš«ç„¡åƒèˆ‡è€…</p>';
                return;
            }

            container.innerHTML = '';

            // æŒ‰åˆ†æ•¸æ’åº
            const sortedUsers = [...adminState.users].sort((a, b) => b.score - a.score);

            sortedUsers.forEach((user, index) => {
                const userElement = document.createElement('div');
                userElement.className = `admin-user-item ${user.connected ? '' : 'offline'}`;

                userElement.innerHTML = `
                    <div>
                        <div style="font-weight: bold; font-size: 1.1em;">
                            ${index + 1}. ${user.name}
                        </div>
                        <div style="font-size: 0.9em; color: #666;">
                            ID: ${user.id}
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 1.2em; font-weight: bold; color: #667eea;">
                            ${user.score} åˆ†
                        </div>
                        <div style="font-size: 0.9em; color: ${user.connected ? '#28a745' : '#dc3545'};">
                            ${user.connected ? 'åœ¨ç·š' : 'é›¢ç·š'}
                        </div>
                    </div>
                `;

                container.appendChild(userElement);
            });
        }

        // æ›´æ–°éŠæˆ²ç‹€æ…‹é¡¯ç¤º
        function updateGameStatus() {
            const statusElement = document.getElementById('gameStatus');
            const statusMap = {
                'waiting': 'ç­‰å¾…ä¸­',
                'starting': 'é–‹å§‹å€’è¨ˆæ™‚',
                'playing': 'é€²è¡Œä¸­',
                'showing_results': 'é¡¯ç¤ºçµæœ',
                'finished': 'å·²çµæŸ'
            };

            statusElement.textContent = statusMap[adminState.gameStatus] || adminState.gameStatus;
        }

        // æ›´æ–°åƒèˆ‡äººæ•¸
        function updatePlayerCount() {
            document.getElementById('playerCount').textContent = adminState.users.length;
        }

        // æ›´æ–°ç•¶å‰é¡Œç›®
        function updateCurrentQuestion() {
            const element = document.getElementById('currentQuestion');
            if (adminState.currentQuestion >= 0) {
                element.textContent = `${adminState.currentQuestion + 1}/3`;
            } else {
                element.textContent = '-';
            }
        }

        // æ›´æ–°æ§åˆ¶æŒ‰éˆ•ç‹€æ…‹
        function updateControlButtons() {
            const startBtn = document.getElementById('startGameBtn');
            const showResultsBtn = document.getElementById('showResultsBtn');
            const nextQuestionBtn = document.getElementById('nextQuestionBtn');
            const endGameBtn = document.getElementById('endGameBtn');

            // é‡ç½®æ‰€æœ‰æŒ‰éˆ•
            [startBtn, showResultsBtn, nextQuestionBtn, endGameBtn].forEach(btn => {
                btn.disabled = true;
            });

            switch (adminState.gameStatus) {
                case 'waiting':
                    startBtn.disabled = false;
                    break;

                case 'playing':
                    showResultsBtn.disabled = false;
                    endGameBtn.disabled = false;
                    break;

                case 'showing_results':
                    nextQuestionBtn.disabled = false;
                    endGameBtn.disabled = false;
                    break;

                case 'finished':
                    // æ‰€æœ‰æŒ‰éˆ•éƒ½ä¿æŒç¦ç”¨ç‹€æ…‹
                    break;
            }
        }

        // æ·»åŠ æ—¥èªŒ
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('gameLog');
            const timestamp = new Date().toLocaleTimeString();

            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;

            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;

            // é™åˆ¶æ—¥èªŒæ•¸é‡
            while (logContainer.children.length > 100) {
                logContainer.removeChild(logContainer.firstChild);
            }
        }

        // ç®¡ç†å“¡æ§åˆ¶å‡½æ•¸
        function startGame() {
            if (adminState.users.length === 0) {
                alert('æ²’æœ‰åƒèˆ‡è€…ï¼Œç„¡æ³•é–‹å§‹éŠæˆ²ï¼');
                return;
            }

            ws.send({ type: 'admin_start_game' });
            addLog('ç®¡ç†å“¡å•Ÿå‹•éŠæˆ²', 'warning');
        }

        function showResults() {
            ws.send({ type: 'admin_show_results' });
            addLog('ç®¡ç†å“¡é¡¯ç¤ºçµæœ', 'warning');
        }

        function nextQuestion() {
            ws.send({ type: 'admin_next_question' });
            addLog('ç®¡ç†å“¡é€²å…¥ä¸‹ä¸€é¡Œ', 'warning');
        }

        function endGame() {
            if (confirm('ç¢ºå®šè¦çµæŸéŠæˆ²å—ï¼Ÿ')) {
                ws.send({ type: 'admin_end_game' });
                addLog('ç®¡ç†å“¡çµæŸéŠæˆ²', 'warning');
            }
        }

        function resetGame() {
            if (confirm('ç¢ºå®šè¦é‡ç½®éŠæˆ²å—ï¼Ÿé€™å°‡æ¸…é™¤æ‰€æœ‰åƒèˆ‡è€…å’Œé€²åº¦ï¼')) {
                location.reload();
            }
        }

        function refreshData() {
            // ç”±æ–¼æˆ‘å€‘é€šéWebSocketå¯¦æ™‚æ›´æ–°ï¼Œé€™è£¡åªæ˜¯æ›´æ–°é¡¯ç¤º
            updateGameStatus();
            updatePlayerCount();
            updateCurrentQuestion();
            updateControlButtons();
        }

        // åˆå§‹åŒ–
        init();
    </script>
</body>
</html>